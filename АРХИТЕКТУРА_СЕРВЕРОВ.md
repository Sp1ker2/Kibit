# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ 5 —Å–µ—Ä–≤–µ—Ä–æ–≤ - –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

## üìä –¢–µ–∫—É—â–∞—è —Å—Ö–µ–º–∞:

```
                        [–ò–ù–¢–ï–†–ù–ï–¢]
                            ‚îÇ
                            ‚Üì
                    [Cloudflare DNS]
              kibitkostreamappv.pp.ua
                            ‚îÇ
                            ‚Üì
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ     SERVER1 (195.133.17.131)          ‚îÇ
        ‚îÇ         üåê NGINX –ë–ê–õ–ê–ù–°–ò–†–û–í–©–ò–ö        ‚îÇ
        ‚îÇ         üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (SQLite)       ‚îÇ
        ‚îÇ         üìÅ –°—Ç–∞—Ç–∏–∫–∞ (dist/)             ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ          ‚îÇ         ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ            ‚îÇ          ‚îÇ         ‚îÇ            ‚îÇ
        ‚Üì            ‚Üì          ‚Üì         ‚Üì            ‚Üì
    SERVER1      SERVER2    SERVER3   SERVER4      SERVER5
    (–º–∞—Å—Ç–µ—Ä)     (worker)   (worker)  (worker)     (worker)
    
    –ù–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ –∑–∞–ø—É—â–µ–Ω–æ:
    ‚îú‚îÄ üîå API —Å–µ—Ä–≤–µ—Ä (port 3001)
    ‚îî‚îÄ üì° LiveKit —Å–µ—Ä–≤–µ—Ä (port 7880)
```

## üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞:

### 1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–∞–π—Ç:**

```
–ë—Ä–∞—É–∑–µ—Ä ‚Üí https://kibitkostreamappv.pp.ua
         ‚Üì
    [Cloudflare] ‚Üí –Ω–∞—Ö–æ–¥–∏—Ç IP: 195.133.17.131
         ‚Üì
    [Server1: Nginx port 443]
```

### 2. **Nginx –Ω–∞ Server1 –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å:**

**–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```nginx
# Upstream –¥–ª—è API (–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –º–µ–∂–¥—É 5 —Å–µ—Ä–≤–µ—Ä–∞–º–∏)
upstream api_backend {
    least_conn;  # –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Å –º–µ–Ω—å—à–∏–º –∫–æ–ª-–≤–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
    server 195.133.17.131:3001;  # server1
    server 195.133.17.179:3001;  # server2
    server 195.133.39.17:3001;   # server3
    server 195.133.39.33:3001;   # server4
    server 195.133.39.41:3001;   # server5
}

# Upstream –¥–ª—è LiveKit (–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –º–µ–∂–¥—É 5 —Å–µ—Ä–≤–µ—Ä–∞–º–∏)
upstream livekit_backend {
    ip_hash;  # –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ–≥–¥–∞ –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
    server 195.133.17.131:7880;  # server1
    server 195.133.17.179:7880;  # server2
    server 195.133.39.17:7880;   # server3
    server 195.133.39.33:7880;   # server4
    server 195.133.39.41:7880;   # server5
}
```

### 3. **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤:**

#### A. –°—Ç–∞—Ç–∏–∫–∞ (HTML, CSS, JS):
```
GET /
GET /assets/index-XXX.js
         ‚Üì
Server1 –æ—Ç–¥–∞—ë—Ç –∏–∑ –ø–∞–ø–∫–∏ dist/
(–ù–ï –±–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç—Å—è - —Ç–æ–ª—å–∫–æ —Å Server1)
```

#### B. API –∑–∞–ø—Ä–æ—Å—ã:
```
POST /api/auth/login
GET /api/recordings
POST /api/recordings/upload
         ‚Üì
Nginx –±–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç –Ω–∞:
‚Üí Server1:3001 (–µ—Å–ª–∏ –º–µ–Ω—å—à–µ –≤—Å–µ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π)
‚Üí Server2:3001 (–∏–ª–∏ —Å—é–¥–∞)
‚Üí Server3:3001 (–∏–ª–∏ —Å—é–¥–∞)
‚Üí Server4:3001 (–∏–ª–∏ —Å—é–¥–∞)
‚Üí Server5:3001 (–∏–ª–∏ —Å—é–¥–∞)
```

#### C. LiveKit WebSocket (—Å—Ç—Ä–∏–º):
```
WSS /rtc
         ‚Üì
Nginx –±–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç –Ω–∞:
‚Üí Server1:7880 (–ø–æ IP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
‚Üí Server2:7880 (–æ–¥–∏–Ω IP –≤—Å–µ–≥–¥–∞ –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ)
‚Üí Server3:7880
‚Üí Server4:7880
‚Üí Server5:7880
```

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ:

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å test_1 –∑–∞—Ö–æ–¥–∏—Ç

```
1. –ë—Ä–∞—É–∑–µ—Ä ‚Üí https://kibitkostreamappv.pp.ua
   ‚Üì
2. Server1 Nginx –æ—Ç–¥–∞—ë—Ç index.html –∏ JS
   ‚Üì
3. JS –¥–µ–ª–∞–µ—Ç: POST /api/auth/login
   ‚Üì
4. Nginx: "–°–µ–π—á–∞—Å Server3 —Å–≤–æ–±–æ–¥–Ω–µ–µ" ‚Üí –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ Server3:3001
   ‚Üì
5. Server3 –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ë–î (–ª–æ–∫–∞–ª—å–Ω–∞—è –∫–æ–ø–∏—è) ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: OK, —Ä–æ–ª—å: user
   ‚Üì
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å—Ç—Ä–∏–º ‚Üí WSS /rtc
   ‚Üì
7. Nginx —Å–º–æ—Ç—Ä–∏—Ç IP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–≥–¥–∞ –Ω–∞ Server2 (ip_hash)
   ‚Üì
8. Server2 LiveKit –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Ç—Ä–∏–º
   ‚Üì
9. –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç: POST /api/recordings/upload (–≤–∏–¥–µ–æ 200MB)
   ‚Üì
10. Nginx: "Server4 —Å–≤–æ–±–æ–¥–µ–Ω" ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ Server4:3001
    ‚Üì
11. Server4 —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ /www/wwwroot/LiveKit/recordings/vinissa/test_1/2025-11-06/
```

## ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ù–ï —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞!

### –°–µ–π—á–∞—Å:
- ‚úÖ **Server1:** –µ—Å—Ç—å –ë–î —Å admin, test_1, test_2, 67
- ‚ùå **Server2-5:** –∫–∞–∂–¥—ã–π —Å–æ–∑–¥–∞–ª –°–í–û–Æ –ë–î —Å —Ç–æ–ª—å–∫–æ admin, test_1, test_2

### –ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç:
–ï—Å–ª–∏ —Å–æ–∑–¥–∞–¥–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `user_tokyo` –Ω–∞ Server1, –∞ –∑–∞–ø—Ä–æ—Å —É–π–¥—ë—Ç –Ω–∞ Server3 ‚Üí **Server3 –Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!** ‚Üí –í—Ö–æ–¥ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç.

## üîß –†–µ—à–µ–Ω–∏—è:

### –í–∞—Ä–∏–∞–Ω—Ç A: **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ë–î (–†–ï–ö–û–ú–ï–ù–î–£–Æ –¥–ª—è –∑–∞–≤—Ç—Ä–∞)**

**–¢–æ–ª—å–∫–æ Server1 —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –ë–î —Ç–æ–ª—å–∫–æ –Ω–∞ Server1
- API —Ç–æ–ª—å–∫–æ –Ω–∞ Server1  
- LiveKit –Ω–∞ –≤—Å–µ—Ö 5 (–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ —Å—Ç—Ä–∏–º–æ–≤)

**Nginx –∫–æ–Ω—Ñ–∏–≥:**
```nginx
# API - –¢–û–õ–¨–ö–û Server1
location /api {
    proxy_pass http://localhost:3001;  # –õ–æ–∫–∞–ª—å–Ω–æ –Ω–∞ Server1
}

# LiveKit - –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞ –≤—Å–µ 5
location /rtc {
    proxy_pass http://livekit_backend;  # –í—Å–µ 5 —Å–µ—Ä–≤–µ—Ä–æ–≤
}
```

### –í–∞—Ä–∏–∞–Ω—Ç B: **Shared –ë–î (MySQL/PostgreSQL)**

–ó–∞–º–µ–Ω–∏—Ç—å SQLite –Ω–∞ MySQL:
- 1 —Å–µ—Ä–≤–µ—Ä MySQL (–∏–ª–∏ –æ–±–ª–∞—á–Ω–∞—è –ë–î)
- –í—Å–µ 5 —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫ –æ–¥–Ω–æ–π –ë–î
- –ü–æ–ª–Ω–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ API

### –í–∞—Ä–∏–∞–Ω—Ç C: **–†–µ–ø–ª–∏–∫–∞—Ü–∏—è –ë–î (—Å–ª–æ–∂–Ω–æ)**

- Master (Server1) - –æ—Å–Ω–æ–≤–Ω–∞—è –ë–î
- Slaves (Server2-5) - –∫–æ–ø–∏–∏
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ rsync –∫–∞–∂–¥—ã–µ N —Å–µ–∫—É–Ω–¥

## üí° –ú–û–Ø –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø –ù–ê –ó–ê–í–¢–†–ê:

### **–í–∞—Ä–∏–∞–Ω—Ç A - –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π (–†–ï–ö–û–ú–ï–ù–î–£–Æ):**

**–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- ‚úÖ –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –°–ï–ô–ß–ê–°
- ‚úÖ –û–¥–Ω–∞ –ë–î - –Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ LiveKit –±–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ 5 —Å–µ—Ä–≤–µ—Ä–æ–≤ (–≤—ã–¥–µ—Ä–∂–∏—Ç –Ω–∞–≥—Ä—É–∑–∫—É)
- ‚úÖ –ó–∞–ø–∏—Å–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ Server1

**–ú–∏–Ω—É—Å—ã:**
- API —Ç–æ–ª—å–∫–æ –Ω–∞ Server1 (–Ω–æ —ç—Ç–æ –Ω–µ –ø—Ä–æ–±–ª–µ–º–∞ –¥–ª—è –∑–∞–≤—Ç—Ä–∞)

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏):

```
[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å] 
    ‚Üì
[Server1: Nginx] ‚Üí –°—Ç–∞—Ç–∏–∫–∞ –∏–∑ dist/
    ‚Üì
[Server1: API 3001] ‚Üí –ë–î –Ω–∞ Server1
    ‚Üì
[Server1-5: LiveKit –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞] ‚Üí –°—Ç—Ä–∏–º—ã –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö
    ‚Üì
[Server1: –ó–∞–ø–∏—Å–∏] ‚Üí –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ Server1
```

## üéØ –•–æ—Ç–∏—Ç–µ —á—Ç–æ–±—ã —è:

1. **–û—Å—Ç–∞–≤–∏–ª –∫–∞–∫ –µ—Å—Ç—å** (—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –∑–∞–≤—Ç—Ä–∞) ‚úÖ
2. **–ù–∞—Å—Ç—Ä–æ–∏–ª MySQL** –¥–ª—è –æ–±—â–µ–π –ë–î? (–Ω—É–∂–Ω–æ 1-2 —á–∞—Å–∞)
3. **–û—Ç–∫–ª—é—á–∏–ª Server2-5** —á—Ç–æ–±—ã –≤—Å—ë –±—ã–ª–æ –ø—Ä–æ—â–µ?

**–î–ª—è –∑–∞–≤—Ç—Ä–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ!** üöÄ

–ß—Ç–æ —Ä–µ—à–∏—Ç–µ?
