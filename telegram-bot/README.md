# Telegram Recordings Bot

Интерактивный бот, который позволяет просматривать и скачивать записи LiveKit
(`room/user/date/video_part`) прямо в Telegram.

## Возможности

- `/browse` — пошаговый выбор комнаты → пользователя → даты → сегмента.
- Инлайн-клавиатуры, чтобы быстро переключаться между папками.
- Отправляет файл пользователю напрямую со storage-сервера (через SSH/SFTP).

## Требования

- Python 3.10+
- Пакеты из `requirements.txt`:
  ```bash
  python3 -m venv .venv
  source .venv/bin/activate
  pip install -r telegram-bot/requirements.txt
  ```
- Доступ к storage-серверу, где находятся записи (SSH, тот же сервер, что
  используется для NFS).

## Переменные окружения

| Переменная            | Описание                                                  |
|-----------------------|-----------------------------------------------------------|
| `TELEGRAM_BOT_TOKEN`  | Токен бота (НЕ храните его в репозитории).                |
| `STORAGE_HOST`        | Хост/IP сервера с записями.                               |
| `STORAGE_USER`        | Пользователь SSH (по умолчанию `root`).                   |
| `STORAGE_PASSWORD`    | Пароль SSH (если используете парольную аутентификацию).   |
| `STORAGE_KEY_PATH`    | Путь к приватному ключу (если подключение по ключу).      |
| `STORAGE_PORT`        | Порт SSH (по умолчанию `22`).                             |
| `RECORDINGS_PATH`     | Путь до корня записей (по умолчанию `/www/wwwroot/LiveKit/recordings`). |

> ⚠️ Токен, пароль и приватные ключи храните в `.env` (не коммитите) или в
> системном менеджере секретов. Если токен был скомпрометирован, перевыпустите его у BotFather.

### Пример запуска

```bash
export TELEGRAM_BOT_TOKEN="$(pass show telegram/livekit-bot)"
export STORAGE_HOST="195.133.39.41"
export STORAGE_USER="root"
export STORAGE_KEY_PATH="$HOME/.ssh/storage-livekit"
# export STORAGE_PASSWORD="..."  # если используете пароль

python telegram-bot/recordings_bot.py
```

## Ограничения

- Бот читает файлы полностью в память перед отправкой. Для сегментов большого
  размера учитывайте лимиты Telegram (до 2 ГБ).
- Без SSH-доступа к storage или при отключённом сервере бот не сможет получить
  список файлов.
- Не запускайте бота на общей машине без ограничений — убедитесь, что доступ к
  токену и SSH-учётным данным защищён.

## Дальнейшие улучшения

- Кэширование дерева каталогов, чтобы уменьшить число SSH-подключений.
- Потоковая передача больших файлов (вместо загрузки в память).
- Ограничение доступа к боту по списку доверенных пользователей (whitelist).


