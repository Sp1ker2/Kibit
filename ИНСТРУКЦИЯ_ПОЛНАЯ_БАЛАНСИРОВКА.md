# üîß –ü–æ–ª–Ω–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ 5 —Å–µ—Ä–≤–µ—Ä–æ–≤ - –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## üìã –û–ì–õ–ê–í–õ–ï–ù–ò–ï

1. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ MySQL/PostgreSQL](#1-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-mysqlpostgresql)
2. [–ü–µ—Ä–µ–Ω–æ—Å –ë–î –Ω–∞ MySQL](#2-–ø–µ—Ä–µ–Ω–æ—Å-–±–¥-–Ω–∞-mysql)
3. [–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ –Ω–∞ —Ä–∞–±–æ—Ç—É —Å MySQL](#3-–∏–∑–º–µ–Ω–µ–Ω–∏–µ-–∫–æ–¥–∞-–Ω–∞-—Ä–∞–±–æ—Ç—É-—Å-mysql)
4. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ NFS –¥–ª—è recordings](#4-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-nfs-–¥–ª—è-recordings)
5. [–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Nginx —Å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π](#5-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ-nginx-—Å-–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π)
6. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#6-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

## 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ MySQL/PostgreSQL

### –í–∞—Ä–∏–∞–Ω—Ç A: PostgreSQL (–†–ï–ö–û–ú–ï–ù–î–£–Æ)

#### –®–∞–≥ 1.1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ Server1 (–º–∞—Å—Ç–µ—Ä –ë–î)

```bash
# –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ Server1
ssh root@195.133.17.131

# –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–∫–µ—Ç—ã
apt update

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º PostgreSQL
apt install -y postgresql postgresql-contrib

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è
systemctl status postgresql

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: Active: active (running)
```

#### –®–∞–≥ 1.2: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è postgres
sudo -u postgres psql

# –í –∫–æ–Ω—Å–æ–ª–∏ PostgreSQL –≤—ã–ø–æ–ª–Ω—è–µ–º:
CREATE DATABASE livekit_stream;
CREATE USER livekit_user WITH ENCRYPTED PASSWORD 'STRONG_PASSWORD_HERE_123';
GRANT ALL PRIVILEGES ON DATABASE livekit_stream TO livekit_user;

# –í—ã—Ö–æ–¥–∏–º
\q
```

#### –®–∞–≥ 1.3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

```bash
# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ —Å –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
nano /etc/postgresql/14/main/postgresql.conf

# –ù–∞—Ö–æ–¥–∏–º —Å—Ç—Ä–æ–∫—É:
#listen_addresses = 'localhost'

# –ú–µ–Ω—è–µ–º –Ω–∞:
listen_addresses = '*'

# –°–æ—Ö—Ä–∞–Ω—è–µ–º (Ctrl+O, Enter, Ctrl+X)
```

```bash
# –†–∞–∑—Ä–µ—à–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
nano /etc/postgresql/14/main/pg_hba.conf

# –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞:
# –†–∞–∑—Ä–µ—à–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏
host    livekit_stream    livekit_user    195.133.17.0/24     md5
host    livekit_stream    livekit_user    195.133.39.0/24     md5

# –°–æ—Ö—Ä–∞–Ω—è–µ–º
```

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º PostgreSQL
systemctl restart postgresql

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 5432
netstat -tuln | grep 5432
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: 0.0.0.0:5432
```

#### –®–∞–≥ 1.4: –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å Server2

```bash
# –ù–∞ Server2
ssh root@195.133.17.179

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–ª–∏–µ–Ω—Ç PostgreSQL
apt install -y postgresql-client

# –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
psql -h 195.133.17.131 -U livekit_user -d livekit_stream

# –ï—Å–ª–∏ —Å–ø—Ä–æ—Å–∏—Ç –ø–∞—Ä–æ–ª—å - –≤–≤–æ–¥–∏–º STRONG_PASSWORD_HERE_123
# –î–æ–ª–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è!

# –í—ã—Ö–æ–¥–∏–º: \q
```

---

## 2. –ü–µ—Ä–µ–Ω–æ—Å –ë–î –Ω–∞ MySQL

### –®–∞–≥ 2.1: –≠–∫—Å–ø–æ—Ä—Ç —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ SQLite

```bash
# –ù–∞ Server1
cd /www/wwwroot/LiveKit/streamApp

# –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
sqlite3 database.db <<EOF > /tmp/users_export.sql
.mode insert users
SELECT * FROM users;
EOF

# –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–º–Ω–∞—Ç—ã
sqlite3 database.db <<EOF > /tmp/rooms_export.sql
.mode insert rooms
SELECT * FROM rooms;
EOF

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–∫—Å–ø–æ—Ä—Ç
cat /tmp/users_export.sql
cat /tmp/rooms_export.sql
```

### –®–∞–≥ 2.2: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –≤ PostgreSQL

```bash
# –°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª —Å–æ —Å—Ö–µ–º–æ–π
cat > /tmp/schema.sql <<'EOF'
-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(255) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    role VARCHAR(50) DEFAULT 'user',
    room_name VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –¢–∞–±–ª–∏—Ü–∞ –∫–æ–º–Ω–∞—Ç
CREATE TABLE rooms (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) UNIQUE NOT NULL,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_room ON users(room_name);
CREATE INDEX idx_rooms_name ON rooms(name);
EOF

# –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ö–µ–º—É
psql -h localhost -U livekit_user -d livekit_stream -f /tmp/schema.sql
```

### –®–∞–≥ 2.3: –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

```bash
# –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º SQLite INSERT –≤ PostgreSQL
cat > /tmp/import_data.sql <<'EOF'
-- –í—Å—Ç–∞–≤–ª—è–µ–º –∫–æ–º–Ω–∞—Ç—ã
INSERT INTO rooms (name, description) VALUES 
('admin', '–ö–æ–º–Ω–∞—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞'),
('vinissa', '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è Vinissa'),
('Azov_1', '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è Azov 1'),
('Azov_2', '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è Azov 2'),
('Berd_1', '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è Berd 1'),
('Berd_2', '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è Berd 2'),
('Borci', '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è Borci'),
('vinissa_2', '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è Vinissa 2'),
('Gazon', '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è Gazon'),
('ZP', '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è ZP'),
('Kiev', '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è Kiev'),
('Tokyo', '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è Tokyo')
ON CONFLICT (name) DO NOTHING;

-- –í—Å—Ç–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
INSERT INTO users (username, password, role, room_name) VALUES 
('admin', 'admin', 'admin', 'admin'),
('test_1', 'test_1', 'user', 'vinissa'),
('test_2', 'test_2', 'user', 'vinissa')
ON CONFLICT (username) DO NOTHING;
EOF

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º
psql -h localhost -U livekit_user -d livekit_stream -f /tmp/import_data.sql

# –ü—Ä–æ–≤–µ—Ä—è–µ–º
psql -h localhost -U livekit_user -d livekit_stream -c "SELECT * FROM users;"
psql -h localhost -U livekit_user -d livekit_stream -c "SELECT * FROM rooms;"
```

---

## 3. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ –Ω–∞ —Ä–∞–±–æ—Ç—É —Å MySQL

### –®–∞–≥ 3.1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥—Ä–∞–π–≤–µ—Ä–∞ PostgreSQL

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
cd /Users/bogdanprihodko/Downloads/LiveKit/streamApp

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥—Ä–∞–π–≤–µ—Ä
npm install pg

# –£–¥–∞–ª—è–µ–º better-sqlite3 (–±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω)
npm uninstall better-sqlite3
```

### –®–∞–≥ 3.2: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ db.js –¥–ª—è PostgreSQL

```bash
# –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π —Ñ–∞–π–ª
cat > server/db-postgres.js <<'EOF'
// –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
import pkg from 'pg';
const { Pool } = pkg;

// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
const pool = new Pool({
  host: '195.133.17.131',  // Server1 - –º–∞—Å—Ç–µ—Ä –ë–î
  port: 5432,
  database: 'livekit_stream',
  user: 'livekit_user',
  password: 'STRONG_PASSWORD_HERE_123',
  max: 20,  // –ú–∞–∫—Å–∏–º—É–º 20 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
  idleTimeoutMillis: 30000,
  connectionTimeoutMillis: 2000,
});

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
pool.on('connect', () => {
  console.log('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ PostgreSQL');
});

pool.on('error', (err) => {
  console.error('‚ùå –û—à–∏–±–∫–∞ PostgreSQL:', err);
});

// API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
export const userDB = {
  // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  async getAllUsers() {
    const result = await pool.query(
      'SELECT id, username, password, role, room_name, created_at FROM users ORDER BY id ASC'
    );
    return result.rows;
  },

  // –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –ª–æ–≥–∏–Ω—É
  async findByUsername(username) {
    const result = await pool.query(
      'SELECT * FROM users WHERE username = $1',
      [username]
    );
    return result.rows[0];
  },

  // –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  async createUser(username, password, role = 'user', room_name = null) {
    try {
      const result = await pool.query(
        'INSERT INTO users (username, password, role, room_name) VALUES ($1, $2, $3, $4) RETURNING *',
        [username, password, role, room_name]
      );
      return result.rows[0];
    } catch (err) {
      if (err.code === '23505') { // unique constraint
        throw new Error('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
      }
      throw err;
    }
  },

  // –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  async updateUser(id, username, password, role, room_name) {
    const result = await pool.query(
      'UPDATE users SET username = $1, password = $2, role = $3, room_name = $4 WHERE id = $5 RETURNING *',
      [username, password, role, room_name, id]
    );
    return result.rows[0];
  },

  // –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  async deleteUser(id) {
    const result = await pool.query('DELETE FROM users WHERE id = $1', [id]);
    return result.rowCount > 0;
  },

  // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
  async authenticate(username, password) {
    const user = await this.findByUsername(username);
    if (user && user.password === password) {
      const role = user.role || 'user';
      return { id: user.id, username: user.username, role, room_name: user.room_name };
    }
    return null;
  },

  // –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  async updateUserRoom(username, roomName) {
    await pool.query(
      'UPDATE users SET room_name = $1 WHERE username = $2',
      [roomName, username]
    );
    return { username, room_name: roomName };
  },

  // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–æ–º–Ω–∞—Ç—ã
  async getAllRooms() {
    const result = await pool.query(
      'SELECT id, name, description FROM rooms ORDER BY id ASC'
    );
    return result.rows;
  },

  // –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É
  async createRoom(name, description = '') {
    try {
      const result = await pool.query(
        'INSERT INTO rooms (name, description) VALUES ($1, $2) RETURNING *',
        [name, description]
      );
      return result.rows[0];
    } catch (err) {
      if (err.code === '23505') {
        throw new Error('–ö–æ–º–Ω–∞—Ç–∞ —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
      }
      throw err;
    }
  },

  // –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É
  async updateRoom(id, name, description) {
    const result = await pool.query(
      'UPDATE rooms SET name = $1, description = $2 WHERE id = $3 RETURNING *',
      [name, description, id]
    );
    return result.rows[0];
  },

  // –£–¥–∞–ª–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É
  async deleteRoom(id) {
    const result = await pool.query('DELETE FROM rooms WHERE id = $1', [id]);
    return result.rowCount > 0;
  }
};

export default pool;
EOF
```

### –®–∞–≥ 3.3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ api.js –¥–ª—è async/await

```bash
# –í–°–ï —Ñ—É–Ω–∫—Ü–∏–∏ –≤ api.js –¥–æ–ª–∂–Ω—ã —Å—Ç–∞—Ç—å async!
# –ü—Ä–∏–º–µ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π:

# –ë–´–õ–û:
app.post('/api/auth/login', (req, res) => {
  const user = userDB.authenticate(username, password);
  // ...
})

# –°–¢–ê–õ–û:
app.post('/api/auth/login', async (req, res) => {
  const user = await userDB.authenticate(username, password);
  // ...
})

# –ë–´–õ–û:
app.get('/api/users', (req, res) => {
  const users = userDB.getAllUsers();
  // ...
})

# –°–¢–ê–õ–û:
app.get('/api/users', async (req, res) => {
  const users = await userDB.getAllUsers();
  // ...
})
```

### –®–∞–≥ 3.4: –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ api.js

```javascript
// –í –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞:
import { userDB } from './db-postgres.js';  // –í–º–µ—Å—Ç–æ './db.js'

// –í—Å–µ —ç—Ç–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å async:
app.post('/api/auth/login', async (req, res) => { ... })
app.get('/api/users', async (req, res) => { ... })
app.post('/api/users', async (req, res) => { ... })
app.put('/api/users/:id', async (req, res) => { ... })
app.delete('/api/users/:id', async (req, res) => { ... })
app.get('/api/room-list', async (req, res) => { ... })
app.post('/api/room-list', async (req, res) => { ... })
app.put('/api/room-list/:id', async (req, res) => { ... })
app.delete('/api/room-list/:id', async (req, res) => { ... })
```

---

## 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NFS –¥–ª—è recordings

### –í–∞—Ä–∏–∞–Ω—Ç A: NFS —Å–µ—Ä–≤–µ—Ä (–æ–±—â–∞—è –ø–∞–ø–∫–∞)

#### –®–∞–≥ 4.1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NFS —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ Server1

```bash
# –ù–∞ Server1
ssh root@195.133.17.131

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º NFS —Å–µ—Ä–≤–µ—Ä
apt install -y nfs-kernel-server

# –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞
mkdir -p /www/wwwroot/LiveKit/recordings
chmod 777 /www/wwwroot/LiveKit/recordings

# –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —ç–∫—Å–ø–æ—Ä—Ç
cat >> /etc/exports <<EOF
/www/wwwroot/LiveKit/recordings 195.133.17.179(rw,sync,no_subtree_check,no_root_squash)
/www/wwwroot/LiveKit/recordings 195.133.39.17(rw,sync,no_subtree_check,no_root_squash)
/www/wwwroot/LiveKit/recordings 195.133.39.33(rw,sync,no_subtree_check,no_root_squash)
/www/wwwroot/LiveKit/recordings 195.133.39.41(rw,sync,no_subtree_check,no_root_squash)
EOF

# –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
exportfs -ra

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º NFS
systemctl restart nfs-kernel-server

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–∫—Å–ø–æ—Ä—Ç—ã
showmount -e localhost
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: /www/wwwroot/LiveKit/recordings
```

#### –®–∞–≥ 4.2: –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Server2-5

```bash
# –ù–∞ –ö–ê–ñ–î–û–ú –∏–∑ Server2, Server3, Server4, Server5:

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º NFS –∫–ª–∏–µ–Ω—Ç
apt install -y nfs-common

# –°–æ–∑–¥–∞—ë–º —Ç–æ—á–∫—É –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
mkdir -p /www/wwwroot/LiveKit/recordings

# –ú–æ–Ω—Ç–∏—Ä—É–µ–º
mount -t nfs 195.133.17.131:/www/wwwroot/LiveKit/recordings /www/wwwroot/LiveKit/recordings

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å
df -h | grep recordings
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: 195.133.17.131:/www/wwwroot/LiveKit/recordings

# –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É
echo "195.133.17.131:/www/wwwroot/LiveKit/recordings /www/wwwroot/LiveKit/recordings nfs defaults 0 0" >> /etc/fstab

# –¢–µ—Å—Ç–∏—Ä—É–µ–º - —Å–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª –Ω–∞ Server2
echo "test from server2" > /www/wwwroot/LiveKit/recordings/test_server2.txt

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ Server1
ssh root@195.133.17.131 "cat /www/wwwroot/LiveKit/recordings/test_server2.txt"
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: test from server2
```

### –í–∞—Ä–∏–∞–Ω—Ç B: S3/MinIO (–æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)

#### –®–∞–≥ 4B.1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ MinIO –Ω–∞ Server1

```bash
# –ù–∞ Server1
wget https://dl.min.io/server/minio/release/linux-amd64/minio
chmod +x minio
mv minio /usr/local/bin/

# –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
mkdir -p /data/minio

# –ó–∞–ø—É—Å–∫–∞–µ–º MinIO
MINIO_ROOT_USER=admin MINIO_ROOT_PASSWORD=miniopassword123 \
  nohup minio server /data/minio --console-address ":9001" > /tmp/minio.log 2>&1 &

# MinIO –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞:
# API: http://195.133.17.131:9000
# Console: http://195.133.17.131:9001
```

#### –®–∞–≥ 4B.2: –°–æ–∑–¥–∞–Ω–∏–µ bucket

```bash
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º MinIO client
wget https://dl.min.io/client/mc/release/linux-amd64/mc
chmod +x mc
mv mc /usr/local/bin/

# –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø
mc alias set myminio http://195.133.17.131:9000 admin miniopassword123

# –°–æ–∑–¥–∞—ë–º bucket
mc mb myminio/recordings

# –ü—Ä–æ–≤–µ—Ä—è–µ–º
mc ls myminio/
```

#### –®–∞–≥ 4B.3: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å S3

```bash
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º AWS SDK
cd /www/wwwroot/LiveKit/streamApp
npm install @aws-sdk/client-s3 @aws-sdk/lib-storage multer-s3
```

```javascript
// –í api.js –º–µ–Ω—è–µ–º multer storage:

import { S3Client } from '@aws-sdk/client-s3';
import multerS3 from 'multer-s3';

const s3 = new S3Client({
  endpoint: 'http://195.133.17.131:9000',
  region: 'us-east-1',
  credentials: {
    accessKeyId: 'admin',
    secretAccessKey: 'miniopassword123'
  },
  forcePathStyle: true
});

const storage = multerS3({
  s3: s3,
  bucket: 'recordings',
  key: function (req, file, cb) {
    const username = req.body.username || 'unknown';
    const roomName = req.body.roomName || 'unknown';
    const now = new Date();
    const dateFolder = now.toISOString().split('T')[0];
    
    // –ü—É—Ç—å: –∫–æ–º–Ω–∞—Ç–∞/username/–¥–∞—Ç–∞/—Ñ–∞–π–ª
    const key = `${roomName}/${username}/${dateFolder}/${file.originalname}`;
    cb(null, key);
  }
});
```

---

## 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Nginx —Å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π

### –®–∞–≥ 5.1: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞ —Å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π

```bash
# –ù–∞ Server1
cat > /etc/nginx/sites-available/kibitkostreamappv.pp.ua <<'EOF'
# Upstream –¥–ª—è API —Å–µ—Ä–≤–µ—Ä–æ–≤ (–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞: –Ω–∞–∏–º–µ–Ω—å—à–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)
upstream api_backend {
    least_conn;
    server 195.133.17.131:3001 weight=2;  # server1 - –º–∞—Å—Ç–µ—Ä, –±–æ–ª—å—à–µ –≤–µ—Å–∞
    server 195.133.17.179:3001;  # server2
    server 195.133.39.17:3001;   # server3
    server 195.133.39.33:3001;   # server4
    server 195.133.39.41:3001;   # server5
    
    # –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä —É–ø–∞–ª - —É–±–∏—Ä–∞–µ–º –Ω–∞ 30 —Å–µ–∫—É–Ω–¥
    server 195.133.17.131:3001 max_fails=3 fail_timeout=30s;
    server 195.133.17.179:3001 max_fails=3 fail_timeout=30s;
    server 195.133.39.17:3001 max_fails=3 fail_timeout=30s;
    server 195.133.39.33:3001 max_fails=3 fail_timeout=30s;
    server 195.133.39.41:3001 max_fails=3 fail_timeout=30s;
    
    keepalive 32;
}

# Upstream –¥–ª—è LiveKit (–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞: –ø–æ IP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
upstream livekit_backend {
    ip_hash;  # –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ–≥–¥–∞ –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
    server 195.133.17.131:7880;
    server 195.133.17.179:7880;
    server 195.133.39.17:7880;
    server 195.133.39.33:7880;
    server 195.133.39.41:7880;
    keepalive 32;
}

# HTTP ‚Üí HTTPS —Ä–µ–¥–∏—Ä–µ–∫—Ç
server {
    listen 80;
    listen [::]:80;
    server_name kibitkostreamappv.pp.ua;
    return 301 https://$server_name$request_uri;
}

# HTTPS —Å–µ—Ä–≤–µ—Ä
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name kibitkostreamappv.pp.ua;
    
    # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ª–∏–º–∏—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ
    client_max_body_size 500M;

    ssl_certificate /etc/letsencrypt/live/kibitkostreamappv.pp.ua/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/kibitkostreamappv.pp.ua/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers HIGH:!aNULL:!MD5;

    # –°—Ç–∞—Ç–∏–∫–∞ - —Ç–æ–ª—å–∫–æ —Å Server1
    location / {
        root /www/wwwroot/LiveKit/streamApp/dist;
        try_files $uri $uri/ /index.html;
        add_header Cache-Control "no-cache";
    }

    # API - –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞ –≤—Å–µ 5 —Å–µ—Ä–≤–µ—Ä–æ–≤
    location /api {
        proxy_pass http://api_backend;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_read_timeout 300s;
        
        # –î–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
        proxy_request_buffering off;
        proxy_buffering off;
    }

    # LiveKit - –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞ –≤—Å–µ 5 —Å–µ—Ä–≤–µ—Ä–æ–≤
    location /rtc {
        proxy_pass http://livekit_backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_read_timeout 86400;
        proxy_send_timeout 86400;
        proxy_buffering off;
        proxy_set_header Origin "";
    }
}
EOF

# –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥
nginx -t

# –ï—Å–ª–∏ OK - –ø—Ä–∏–º–µ–Ω—è–µ–º
systemctl reload nginx
```

### –®–∞–≥ 5.2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ Nginx —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
for i in {1..10}; do
  curl -s https://kibitkostreamappv.pp.ua/api/room-list | grep -o '"name":"admin"' && echo " - Request $i"
done

# –°–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏ –Ω–∞ –†–ê–ó–ù–´–• —Å–µ—Ä–≤–µ—Ä–∞—Ö:
# Server1
ssh root@195.133.17.131 "tail -5 /tmp/api.log"

# Server2
ssh root@195.133.17.179 "tail -5 /tmp/api.log"

# –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–∞ –†–ê–ó–ù–´–ï —Å–µ—Ä–≤–µ—Ä—ã - –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç!
```

---

## 6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –®–∞–≥ 6.1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î –Ω–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö

```bash
# –ù–∞ Server1
ssh root@195.133.17.131
cd /www/wwwroot/LiveKit/streamApp
node -e "import('./server/db-postgres.js').then(m => m.userDB.getAllUsers().then(console.log))"

# –ù–∞ Server2
ssh root@195.133.17.179
cd /www/wwwroot/LiveKit/streamApp
node -e "import('./server/db-postgres.js').then(m => m.userDB.getAllUsers().then(console.log))"

# –î–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑–∞—Ç—å –û–î–ò–ù–ê–ö–û–í–´–• –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!
```

### –®–∞–≥ 6.2: –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
# –°–æ–∑–¥–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ Server1
curl -X POST https://kibitkostreamappv.pp.ua/api/users \
  -H "Content-Type: application/json" \
  -d '{"username":"test_tokyo","password":"test123","role":"user","room_name":"Tokyo"}'

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ–Ω –Ω–∞ Server3
ssh root@195.133.39.17 "cd /www/wwwroot/LiveKit/streamApp && node -e \"import('./server/db-postgres.js').then(m => m.userDB.findByUsername('test_tokyo').then(console.log))\""

# –î–æ–ª–∂–µ–Ω –Ω–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!
```

### –®–∞–≥ 6.3: –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ

```bash
# 1. –ó–∞—Ö–æ–¥–∏–º –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
# 2. –ó–∞–ø—É—Å–∫–∞–µ–º —Å—Ç—Ä–∏–º
# 3. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —á–µ—Ä–µ–∑ 1 –º–∏–Ω—É—Ç—É
# 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –í–°–ï–• —Å–µ—Ä–≤–µ—Ä–∞—Ö:

for SERVER in 195.133.17.131 195.133.17.179 195.133.39.17 195.133.39.33 195.133.39.41; do
  echo "=== $SERVER ==="
  ssh root@$SERVER "ls -lh /www/wwwroot/LiveKit/recordings/*/*/2025-11-06/ 2>/dev/null | tail -3"
done

# –í—Å–µ —Å–µ—Ä–≤–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å –û–î–ò–ù–ê–ö–û–í–´–ï —Ñ–∞–π–ª—ã (—á–µ—Ä–µ–∑ NFS)!
```

### –®–∞–≥ 6.4: –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞–≥—Ä—É–∑–∫–∞
watch -n 1 '
echo "=== API –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö ==="
for i in 1 2 3 4 5; do
  echo -n "Server$i: "
  ssh root@195.133.17.131 "netstat -an | grep :3001 | grep ESTABLISHED | wc -l"
done

echo ""
echo "=== LiveKit –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π ==="
for i in 1 2 3 4 5; do
  echo -n "Server$i: "
  ssh root@195.133.17.131 "netstat -an | grep :7880 | grep ESTABLISHED | wc -l"
done
'
```

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –ü–†–û–í–ï–†–ö–ê

### –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º:

```bash
# 1. PostgreSQL —Ä–∞–±–æ—Ç–∞–µ—Ç
ssh root@195.133.17.131 "systemctl status postgresql | grep Active"

# 2. –í—Å–µ API –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ PostgreSQL
for IP in 195.133.17.131 195.133.17.179 195.133.39.17 195.133.39.33 195.133.39.41; do
  echo "=== $IP ==="
  ssh root@$IP "curl -s http://localhost:3001/api/room-list | jq length"
done
# –í—Å–µ –¥–æ–ª–∂–Ω—ã –≤–µ—Ä–Ω—É—Ç—å: 12

# 3. NFS —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö
for IP in 195.133.17.179 195.133.39.17 195.133.39.33 195.133.39.41; do
  echo "=== $IP ==="
  ssh root@$IP "df -h | grep recordings"
done

# 4. Nginx –±–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç
for i in {1..20}; do
  curl -s https://kibitkostreamappv.pp.ua/api/room-list > /dev/null && echo "OK $i"
done
# –°–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏ - –∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å—Å—è!

# 5. LiveKit —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö
for IP in 195.133.17.131 195.133.17.179 195.133.39.17 195.133.39.33 195.133.39.41; do
  echo "=== $IP ==="
  ssh root@$IP "ps aux | grep livekit-server | grep -v grep | wc -l"
done
# –í—Å–µ –¥–æ–ª–∂–Ω—ã –≤–µ—Ä–Ω—É—Ç—å: 1
```

---

## üöÄ –ê–í–¢–û–ú–ê–¢–ò–ó–ê–¶–ò–Ø —á–µ—Ä–µ–∑ Ansible

### –°–æ–∑–¥–∞–π—Ç–µ –ø–ª–µ–π–±—É–∫ –¥–ª—è –≤—Å–µ—Ö —à–∞–≥–æ–≤:

```yaml
# ansible/setup-postgres-balancing.yml
---
- name: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏
  hosts: all
  become: yes
  
  tasks:
    # 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL –Ω–∞ –º–∞—Å—Ç–µ—Ä–µ
    - name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL
      apt:
        name:
          - postgresql
          - postgresql-contrib
        state: present
      when: server_role == "master"
    
    # 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ NFS —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –º–∞—Å—Ç–µ—Ä–µ
    - name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ NFS —Å–µ—Ä–≤–µ—Ä–∞
      apt:
        name: nfs-kernel-server
        state: present
      when: server_role == "master"
    
    # 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ NFS –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ workers
    - name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ NFS –∫–ª–∏–µ–Ω—Ç–∞
      apt:
        name: nfs-common
        state: present
      when: server_role == "worker"
    
    # 4. –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ NFS
    - name: –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ recordings
      mount:
        path: /www/wwwroot/LiveKit/recordings
        src: 195.133.17.131:/www/wwwroot/LiveKit/recordings
        fstype: nfs
        state: mounted
      when: server_role == "worker"
    
    # –ò —Ç–∞–∫ –¥–∞–ª–µ–µ...
```

---

## ‚è±Ô∏è –í–†–ï–ú–Ø –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

- **–®–∞–≥ 1 (PostgreSQL):** 15 –º–∏–Ω—É—Ç
- **–®–∞–≥ 2 (–ü–µ—Ä–µ–Ω–æ—Å –ë–î):** 10 –º–∏–Ω—É—Ç
- **–®–∞–≥ 3 (–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–¥–∞):** 30 –º–∏–Ω—É—Ç
- **–®–∞–≥ 4 (NFS):** 20 –º–∏–Ω—É—Ç
- **–®–∞–≥ 5 (Nginx):** 10 –º–∏–Ω—É—Ç
- **–®–∞–≥ 6 (–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ):** 30 –º–∏–Ω—É—Ç

**–ò–¢–û–ì–û:** ~2 —á–∞—Å–∞ —Ä–∞–±–æ—Ç—ã

---

## ‚ö†Ô∏è –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ê (–ë–´–°–¢–†–ï–ï):

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SQLite + rsync —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

```bash
# –ö–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ –∫–æ–ø–∏—Ä—É–µ–º –ë–î —Å Server1 –Ω–∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ
# –ù–∞ Server2-5 –¥–æ–±–∞–≤–ª—è–µ–º –≤ cron:
*/1 * * * * rsync -az root@195.133.17.131:/www/wwwroot/LiveKit/streamApp/database.db /www/wwwroot/LiveKit/streamApp/database.db.tmp && mv /www/wwwroot/LiveKit/streamApp/database.db.tmp /www/wwwroot/LiveKit/streamApp/database.db

# –ü–ª—é—Å—ã: –Ω–µ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å –∫–æ–¥, –±—ã—Å—Ç—Ä–æ
# –ú–∏–Ω—É—Å—ã: –∑–∞–¥–µ—Ä–∂–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ ~1 –º–∏–Ω—É—Ç–∞
```

---

**–ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –≤—ã–±—Ä–∞—Ç—å?**

1. **PostgreSQL + NFS** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ –¥–æ–ª–≥–æ (2 —á–∞—Å–∞)
2. **SQLite + rsync** - –±—ã—Å—Ç—Ä–æ (10 –º–∏–Ω—É—Ç), –Ω–æ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
3. **–û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –∑–∞–≤—Ç—Ä–∞ ‚úÖ

–ß—Ç–æ –¥–µ–ª–∞–µ–º?

