⚠️ ИСПРАВЛЕНИЕ ПОДКЛЮЧЕНИЯ К LIVEKIT:

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

ПРОБЛЕМА: Timeout при подключении к LiveKit через wss://

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

ШАГ 1: Проверьте что LiveKit запущен на сервере

Выполните на сервере:

netstat -tulpn | grep 7880

Или:

ss -tulpn | grep 7880

Если порта НЕТ - LiveKit не запущен!

Запустите daemon в панели или:
cd /www/wwwroot/LiveKit
./start-with-https.sh

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

ШАГ 2: Исправьте Nginx конфигурацию

Загрузите и выполните на сервере:

1. Файл: fix-livekit-connection.sh
2. Путь на сервере: /www/wwwroot/LiveKit/fix-livekit-connection.sh

Выполните:

sudo bash /www/wwwroot/LiveKit/fix-livekit-connection.sh

Скрипт:
- Проверит что LiveKit запущен
- Обновит Nginx конфигурацию
- Перезагрузит Nginx

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

ШАГ 3: Если SSL (HTTPS) установлен

Если SSL сертификат установлен через Certbot, нужно:

1. Отредактировать конфигурацию Nginx:
   sudo nano /etc/nginx/sites-available/kibitkostreamappv.pp.ua

2. Раскомментировать HTTPS блок в файле
   (он закомментирован в скрипте)

3. Указать правильные пути к SSL сертификатам:
   ssl_certificate /etc/letsencrypt/live/kibitkostreamappv.pp.ua/fullchain.pem;
   ssl_certificate_key /etc/letsencrypt/live/kibitkostreamappv.pp.ua/privkey.pem;

4. Проверить и перезагрузить:
   sudo nginx -t
   sudo systemctl reload nginx

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

ШАГ 4: Проверьте логи

После исправлений проверьте:

1. Логи LiveKit:
   tail -f /tmp/livekit.log

2. Логи Nginx:
   tail -f /var/log/nginx/error.log

3. Логи daemon в панели (нажмите "Log" на daemon)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

ШАГ 5: Проверьте в браузере

1. Откройте консоль (F12)
2. Проверьте Network tab
3. Найдите WebSocket подключение к /rtc
4. Проверьте статус - должен быть 101 Switching Protocols

Если статус 502, 503, 504 - Nginx не может подключиться к LiveKit
(проверьте что LiveKit запущен на порту 7880)

Если статус 404 - Nginx не находит путь /rtc
(проверьте конфигурацию Nginx)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

ВАЖНО: Nginx должен проксировать /rtc на http://127.0.0.1:7880/rtc

В конфигурации должно быть:

location /rtc {
    proxy_pass http://127.0.0.1:7880/rtc;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    ...
}

Обратите внимание: proxy_pass должен заканчиваться на /rtc!

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

После всех исправлений:

1. Обновите страницу в браузере (Ctrl+F5)
2. Откройте консоль (F12)
3. Проверьте логи подключения
4. Попробуйте запустить стрим

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

