# üöÄ –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ Production –≤–µ—Ä—Å–∏–∏ –Ω–∞ 5 —Å–µ—Ä–≤–µ—Ä–∞—Ö

## üìã –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:

**5 —Å–µ—Ä–≤–µ—Ä–æ–≤:**
- **Server1** (195.133.17.131) - –ú–ê–°–¢–ï–† (–ë–î + Nginx + —Å—Ç–∞—Ç–∏–∫–∞)
- **Server2-5** - WORKERS (API + LiveKit)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏] ‚Üí [Server1: Nginx] ‚Üí {
    –°—Ç–∞—Ç–∏–∫–∞ (dist/) ‚Üí –æ—Ç–¥–∞—ë—Ç —Å Server1
    /api ‚Üí –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞ –≤—Å–µ 5 —Å–µ—Ä–≤–µ—Ä–æ–≤
    /rtc (LiveKit) ‚Üí –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞ –≤—Å–µ 5 —Å–µ—Ä–≤–µ—Ä–æ–≤
}
```

## ‚úÖ –ß–¢–û –£–ñ–ï –ì–û–¢–û–í–û:

1. ‚úÖ **–ë–î –æ–±–Ω–æ–≤–ª–µ–Ω–∞** —Å 12 –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏
2. ‚úÖ **–§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è** —Å –≤—ã–±–æ—Ä–æ–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
3. ‚úÖ **–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** –ø–æ 15 —Å–µ–∫—É–Ω–¥ (–¥–ª—è —Ç–µ—Å—Ç–∞)
4. ‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫**: –∫–æ–º–Ω–∞—Ç–∞/username/–¥–∞—Ç–∞/
5. ‚úÖ **–°—Ç—Ä–∞–Ω–∏—Ü–∞ /database** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î
6. ‚úÖ **–§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–æ–±—Ä–∞–Ω** –≤ dist/
7. ‚úÖ **Server1 —Ä–∞–±–æ—Ç–∞–µ—Ç** –≤ PROD —Ä–µ–∂–∏–º–µ

## üöÄ –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ –≤—Å–µ 5 —Å–µ—Ä–≤–µ—Ä–æ–≤:

### –í–∞—Ä–∏–∞–Ω—Ç 1: Ansible (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

```bash
cd /Users/bogdanprihodko/Downloads/LiveKit/ansible
ansible-playbook -i inventory.ini deploy-production.yml
```

–≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –°–∫–æ–ø–∏—Ä—É–µ—Ç –∫–æ–¥ –Ω–∞ –≤—Å–µ 5 —Å–µ—Ä–≤–µ—Ä–æ–≤
- –°–∫–æ–ø–∏—Ä—É–µ—Ç –ë–î —Ç–æ–ª—å–∫–æ –Ω–∞ Server1 (–º–∞—Å—Ç–µ—Ä)
- –ó–∞–ø—É—Å—Ç–∏—Ç API –∏ LiveKit –Ω–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö
- –ù–∞—Å—Ç—Ä–æ–∏—Ç Nginx –Ω–∞ Server1

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ç–µ–∫—É—â–∏–π —Å–ø–æ—Å–æ–±)

**–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ Server2-5:**
```bash
for HOST in 195.133.17.179 195.133.39.17 195.133.39.33 195.133.39.41; do
  scp -r streamApp/server/ root@$HOST:/www/wwwroot/LiveKit/streamApp/
  scp -r streamApp/package*.json root@$HOST:/www/wwwroot/LiveKit/streamApp/
  ssh root@$HOST "cd /www/wwwroot/LiveKit/streamApp && npm install --production && pkill -f 'node server' || true && nohup node server/api.js > api.log 2>&1 &"
done
```

## ‚ö†Ô∏è –í–ê–ñ–ù–û –î–õ–Ø –ó–ê–í–¢–†–ê:

### 1. **–£–≤–µ–ª–∏—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –∑–∞–ø–∏—Å–∏ –¥–æ 5 –º–∏–Ω—É—Ç**

–°–µ–π—á–∞—Å 15 —Å–µ–∫—É–Ω–¥ - —ç—Ç–æ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∞! –ü–µ—Ä–µ–¥ –∑–∞–≤—Ç—Ä–∞ –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å:

```typescript
// –í UserStreamPage.tsx –∏–∑–º–µ–Ω–∏—Ç—å:
}, 15 * 1000) // ‚Üê –¢–ï–°–¢
// –Ω–∞:
}, 5 * 60 * 1000) // 5 –º–∏–Ω—É—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω
```

### 2. **Nginx –ª–∏–º–∏—Ç—ã**

–£–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ:
- ‚úÖ `client_max_body_size 500M` - —Ñ–∞–π–ª—ã –¥–æ 500MB

### 3. **Nginx –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞**

–¢–µ–∫—É—â–∏–π –∫–æ–Ω—Ñ–∏–≥ `/etc/nginx/sites-enabled/kibitkostreamappv.pp.ua`:
- ‚ùå –ë–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç frontend –Ω–∞ port 5173 (dev servers)
- ‚ùå –ë–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç API –Ω–∞ –≤—Å–µ 5 —Å–µ—Ä–≤–µ—Ä–æ–≤ (–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ server1)

**–ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å** –Ω–∞:
- ‚úÖ –°—Ç–∞—Ç–∏–∫–∞ —Å Server1 (dist/)
- ‚úÖ API –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞ –≤—Å–µ 5 —Å–µ—Ä–≤–µ—Ä–æ–≤
- ‚úÖ LiveKit –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞ –≤—Å–µ 5 —Å–µ—Ä–≤–µ—Ä–æ–≤

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –∑–∞–≤—Ç—Ä–∞:

### –°—Ü–µ–Ω–∞—Ä–∏–π A: –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ Server1 (–ü–†–û–©–ï)

**–ü–ª—é—Å—ã:**
- –†–∞–±–æ—Ç–∞–µ—Ç —É–∂–µ —Å–µ–π—á–∞—Å
- –ù–µ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É
- –û–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä - –ª–µ–≥—á–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å

**–ú–∏–Ω—É—Å—ã:**
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ –Ω–∞–≥—Ä—É–∑–∫–∞
- –ù–µ—Ç –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π B: –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –≤—Å–µ 5 —Å–µ—Ä–≤–µ—Ä–æ–≤ (–ù–ê–î–Å–ñ–ù–ï–ï)

**–ü–ª—é—Å—ã:**
- –í—ã–¥–µ—Ä–∂–∏—Ç –±–æ–ª—å—à–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å
- –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏

**–ú–∏–Ω—É—Å—ã:**
- –ù—É–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ë–î
- –°–ª–æ–∂–Ω–µ–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å

## üí° –ú–û–Ø –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø:

**–î–ª—è –∑–∞–≤—Ç—Ä–∞:** –û—Å—Ç–∞–≤—å—Ç–µ Server1, –Ω–æ **–ø–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ**:

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥ –Ω–∞ Server2-5 (—á–µ—Ä–µ–∑ Ansible)
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ API –∏ LiveKit –Ω–∞ –≤—Å–µ—Ö
3. –ù–æ Nginx –ø–æ–∫–∞ –æ—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–∞ Server1
4. –ï—Å–ª–∏ Server1 —É–ø–∞–¥—ë—Ç ‚Üí –±—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ Nginx

## üöÄ –ß—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å?

1. **–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –≤—Å–µ 5 —Å–µ—Ä–≤–µ—Ä–æ–≤ —Å–µ–π—á–∞—Å?**
2. **–û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ Server1 –¥–ª—è –∑–∞–≤—Ç—Ä–∞?**
3. **–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã?**

–°–∫–∞–∂–∏—Ç–µ –∫–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –∏ —è —Å–¥–µ–ª–∞—é!

