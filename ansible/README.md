# üöÄ Ansible —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ LiveKit Stream App

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

1. **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `inventory.ini`** –≤–º–µ—Å—Ç–æ `inventory.yml` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç Ansible)
2. **–ü—Ä–æ–≤–µ—Ä–∫–∏ "—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º"** –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
3. **–ü—Ä–æ–≤–µ—Ä–∫–∏ "—É–∂–µ –∑–∞–ø—É—â–µ–Ω–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º"** –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤** –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **Ansible** —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:
   ```bash
   # macOS
   brew install ansible
   
   # Linux
   sudo apt-get install ansible
   ```

2. **Python** 3.6+ –Ω–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö (–æ–±—ã—á–Ω–æ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö

```bash
cd ansible
ansible-playbook playbook.yml
```

–≠—Ç–æ—Ç playbook:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ –≤—Å–µ–º —Å–µ—Ä–≤–µ—Ä–∞–º
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç Node.js, npm, rsync, livekit-server **—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã**
- ‚úÖ –°–∫–æ–ø–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –≤—Å–µ —Å–µ—Ä–≤–µ—Ä—ã
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ npm **—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç node_modules**
- ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–∏—Å—ã **—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω—ã**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç —á—Ç–æ –≤—Å–µ –ø–æ—Ä—Ç—ã —Å–ª—É—à–∞—é—Ç—Å—è

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx Load Balancer

```bash
ansible-playbook nginx-lb.yml
```

–≠—Ç–æ—Ç playbook:
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç Nginx **—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω**
- ‚úÖ –°–æ–∑–¥–∞—Å—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Load Balancer **—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç**
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –º–µ–∂–¥—É –≤—Å–µ–º–∏ 5 —Å–µ—Ä–≤–µ—Ä–∞–º–∏
- ‚úÖ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç Nginx

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
ansible all -m ping

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ—Ä—Ç–æ–≤
ansible all -m shell -a "netstat -tuln | grep -E '3001|5173|7880'"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
ansible all -m shell -a "ps aux | grep -E 'livekit-server|npm run api|npm run dev' | grep -v grep"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
ansible all -m shell -a "tail -n 20 /tmp/api.log"
```

## üìù –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Makefile

```bash
make deploy    # –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö
make nginx     # –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Load Balancer
make check     # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
make status    # –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å
make logs      # –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏
make restart   # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
```

## üîç –ß—Ç–æ –¥–µ–ª–∞–µ—Ç playbook

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–µ—Å–ª–∏ –Ω–µ—Ç):
- ‚úÖ Node.js 18+
- ‚úÖ npm
- ‚úÖ rsync
- ‚úÖ livekit-server

### –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ (—Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–∏–≤—à–∏–µ—Å—è):
- ‚úÖ streamApp/ (–∏—Å–∫–ª—é—á–∞—è node_modules, .git, –ª–æ–≥–∏)
- ‚úÖ livekit/ (–∏—Å–∫–ª—é—á–∞—è .git, –ª–æ–≥–∏)
- ‚úÖ start-simple.sh, setup.sh
- ‚úÖ database.db (—Ç–æ–ª—å–∫–æ –Ω–∞ master —Å–µ—Ä–≤–µ—Ä)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
- ‚úÖ npm install (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç node_modules)

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω—ã):
- ‚úÖ LiveKit (–ø–æ—Ä—Ç 7880)
- ‚úÖ API (–ø–æ—Ä—Ç 3001)
- ‚úÖ Frontend (–ø–æ—Ä—Ç 5173)

## üîÑ –ò–¥–∏–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

Playbook **–∏–¥–∏–ø–æ—Ç–µ–Ω—Ç–Ω—ã–π** - –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –º–Ω–æ–≥–æ —Ä–∞–∑:
- ‚úÖ –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ
- ‚úÖ –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç —É–∂–µ –∑–∞–ø—É—â–µ–Ω–Ω–æ–µ
- ‚úÖ –ù–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–∞–π–ª—ã –µ—Å–ª–∏ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
ansible/
‚îú‚îÄ‚îÄ ansible.cfg          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Ansible
‚îú‚îÄ‚îÄ inventory.ini        # –°–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤ (INI —Ñ–æ—Ä–º–∞—Ç)
‚îú‚îÄ‚îÄ playbook.yml         # –û—Å–Ω–æ–≤–Ω–æ–π playbook
‚îú‚îÄ‚îÄ nginx-lb.yml         # Playbook –¥–ª—è Load Balancer
‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îî‚îÄ‚îÄ nginx-lb.conf.j2 # –®–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx
‚îú‚îÄ‚îÄ Makefile             # –£–¥–æ–±–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
‚îî‚îÄ‚îÄ README.md            # –≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### Dry-run (–ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
```bash
ansible-playbook playbook.yml --check
```

### –£–≤–µ–ª–∏—á–µ–Ω–∏–µ verbosity
```bash
ansible-playbook playbook.yml -v    # -v, -vv, -vvv, -vvvv
```

### –ó–∞–ø—É—Å–∫ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
```bash
ansible-playbook playbook.yml --limit server1
```

## ‚úÖ –í—Å–µ –≥–æ—Ç–æ–≤–æ!

Playbook —Ç–µ–ø–µ—Ä—å:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `inventory.ini` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)
- ‚úÖ –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ
- ‚úÖ –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç —É–∂–µ –∑–∞–ø—É—â–µ–Ω–Ω–æ–µ
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
